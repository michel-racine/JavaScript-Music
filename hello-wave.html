<!DOCTYPE html>
<html>
  <body>
    <button id="make">Generate WAV</button>

    <script>
      document.getElementById('make').addEventListener('click', () => {
        const sampleRate = 44100; // Samples per second
        const duration = 1; // Total sample length time in seconds
        const freq = 440; // Hz (A4)
        const numSamples = sampleRate * duration;
        const volume = 0.5; // 0.0 - 1.0

        // Magic number 44 represents length of minimal header
        // TODO: Add options for additional metadata headers like name, album, author
        // Create raw PCM data (16-bit signed)
        const buffer = new ArrayBuffer(44 + numSamples * 2); // header + data
        const view = new DataView(buffer);

        // Write WAV header (little-endian)
        function writeString(offset, string) {
          for (let i = 0; i < string.length; i++) {
            view.setUint8(offset + i, string.charCodeAt(i));
          }
        }

        writeString(0, 'RIFF');
        view.setUint32(4, 36 + numSamples * 2, true); // file size - 8
        writeString(8, 'WAVE');
        writeString(12, 'fmt ');
        view.setUint32(16, 16, true); // PCM chunk size
        view.setUint16(20, 1, true); // PCM format
        view.setUint16(22, 1, true); // mono
        view.setUint32(24, sampleRate, true);
        view.setUint32(28, sampleRate * 2, true); // byte rate (sampleRate * blockAlign)
        view.setUint16(32, 2, true); // block align (channels * bytes per sample)
        view.setUint16(34, 16, true); // bits per sample
        writeString(36, 'data');
        view.setUint32(40, numSamples * 2, true);

        // Write sine wave samples
        for (let i = 0; i < numSamples; i++) {
          const t = i / sampleRate;
          const sample = Math.sin(2 * Math.PI * freq * t);
          view.setInt16(44 + i * 2, sample * 0x7fff * volume, true);
        }

        // Make blob & download
        const blob = new Blob([buffer], { type: 'audio/wav' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'toy.wav';
        a.click();
      });
    </script>
  </body>
</html>
